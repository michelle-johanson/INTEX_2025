<nav class="er-navbar">
    <div class="er-navbar-inner">

        <!-- LEFT: Logo + (Desktop) Menu -->
        <div class="er-navbar-left">
            <a href="/" class="er-navbar-logo">
                <img src="/img/logo-no-bg.png" alt="Ella Rises Logo">
            </a>

            <!-- DESKTOP MENU -->
            <ul class="er-navbar-menu" id="mobileMenu">
                <% const isManager=session && session.access_level && (session.access_level.toLowerCase()==="manager" ||
                    session.access_level.toLowerCase()==="admin" ); const menus=[ { label: "EVENTS" , href: "/events" },
                    { label: "REGISTER" , items: [ { text: "Registrations" , href: "/registrations" }, {
                    text: "Participants" , href: "/participants" }, { text: "Milestones" , href: "/milestones" } ]}, {
                    label: "SURVEY" , items: [ { text: "Surveys" , href: "/surveys" }, { text: "Dashboard" ,
                    href: "/dashboard" } ]} ]; %>

                    <% menus.forEach(menu=> { %>

                        <% if (menu.href) { %>
                            <li class="nav-item">
                                <a href="<%= menu.href %>" class="er-nav-link">
                                    <%= menu.label %>
                                </a>
                            </li>
                            <% } else { %>
                                <li class="nav-item dropdown">
                                    <a class="er-nav-link dropdown-toggle mobile-toggle" href="#">
                                        <%= menu.label %>
                                    </a>

                                    <ul class="dropdown-menu">
                                        <% menu.items.forEach(item=> { %>
                                            <li>
                                                <a class="dropdown-item" href="<%= item.href %>">
                                                    <%= item.text %>
                                                </a>
                                            </li>
                                            <% }) %>
                                    </ul>
                                </li>
                                <% } %>

                                    <% }) %>

                                        <!-- DONATE -->
                                        <a class="er-navbar-donate" href="/donations/new">DONATE</a>
            </ul>
        </div>

        <!-- RIGHT: Desktop Login / Username -->
        <div class="er-navbar-right">
            <% if (!session || !session.isLoggedIn) { %>
                <a href="/auth/login" class="er-nav-link">LOGIN</a>
                <% } else { %>
                    <div class="nav-item dropdown er-account-dropdown">
                        <a class="er-nav-link dropdown-toggle" href="#">
                            <%= session.username %>
                        </a>

                        <ul class="dropdown-menu dropdown-menu-end">
                            <% if (isManager) { %>
                                <li><a class="dropdown-item" href="/users">Manage Users</a></li>
                                <li><a class="dropdown-item" href="/donations">Manage Donations</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <% } %>
                                    <li><a class="dropdown-item" href="/auth/logout">Logout</a></li>
                        </ul>
                    </div>
                    <% } %>
        </div>

        <!-- MOBILE HAMBURGER (Now clickable!) -->
        <div class="er-navbar-hamburger" id="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>

    </div>
</nav>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const hamburger = document.getElementById("hamburger");
        const menu = document.getElementById("mobileMenu");

        hamburger.addEventListener("click", () => {
            hamburger.classList.toggle("active");
            menu.classList.toggle("open");

            document.body.style.overflow = menu.classList.contains("open") ? "hidden" : "";
        });

        document.querySelectorAll(".mobile-toggle").forEach(toggle => {
            toggle.addEventListener("click", e => {
                e.preventDefault();
                toggle.closest(".dropdown").classList.toggle("open");
            });
        });
    });
</script>