<div class="container mt-4">
    <h1>Schedule New Event Occurrence</h1>

    <form action="/eventOccurrences/new" method="POST" class="mt-3">

        <label for="EventID" class="form-label">Event Template (Required)</label>
        <select id="EventID" name="EventID" class="form-select" required>
            <option value="" disabled <%= !selectedEventId ? 'selected' : '' %>>Select an event…</option>
            
            <% events.forEach(e=> { %>
                <% 
                    // CRITICAL FIX: Check if the event_id matches the ID passed from the URL query
                    const isSelected = (typeof selectedEventId !== 'undefined' && 
                                        String(selectedEventId) === String(e.event_id)); 
                %>
                <option value="<%= e.event_id %>" <%= isSelected ? 'selected' : '' %>>
                    <%= e.name %> — <%= e.event_type %>
                </option>
                <% }) %>
        </select>

        <label class="form-label mt-3">Start Date & Time</label>
        <input type="datetime-local" name="EventDateTimeStart" class="form-control" required>

        <label class="form-label mt-3">End Date & Time</label>
        <input type="datetime-local" name="EventDateTimeEnd" class="form-control">

        <label class="form-label mt-3">Location</label>
        <input type="text" name="EventLocation" class="form-control" required>

        <label class="form-label mt-3">Capacity</label>
        <input type="number" min="1" name="EventCapacity" class="form-control">

        <label class="form-label mt-3">Registration Deadline</label>
        <input type="date" name="EventRegistrationDeadline" class="form-control">

        <div class="d-flex gap-3 mt-4">
            <button type="submit" class="btn btn-primary">Create Occurrence</button>
            
            <% if (typeof selectedEventId !== 'undefined' && selectedEventId) { %>
                <a href="/events/<%= selectedEventId %>" class="btn btn-secondary">Cancel</a>
            <% } else { %>
                <a href="/eventOccurrences" class="btn btn-secondary">Cancel</a>
            <% } %>
        </div>

    </form>
</div>