<section class="page-container">
    <div class="container-inner">

        <!-- HEADER -->
        <div class="container-header">
            <h1 class="page-title">Manager / Admin Staff Accounts</h1>
            <div class="heading-underline"></div>
        </div>

        <% 
            const roleRaw =
                session.access_level ||
                session.role ||
                (session.user && (session.user.access_level || session.user.role)) ||
                "";
            const isManager = roleRaw.toLowerCase() === "manager" || roleRaw.toLowerCase() === "admin";

            // FIX: Handle both 'staffList' (from route) or 'managers' to prevent crash
            const accounts = (typeof managers !== 'undefined') ? managers : ((typeof staffList !== 'undefined') ? staffList : []);
        %>

        <!-- TABLE CONTROLS (converted from Bootstrap flex) -->
        <div class="table-controls">

            <!-- ADD NEW MANAGER BUTTON -->
            <% if (isManager) { %>
                <a href="/staff/new" class="btn btn-primary btn-small">
                    + Add New Manager
                </a>
            <% } else { %>
                <div></div>
            <% } %>

            <!-- SEARCH FORM -->
            <form action="/staff" method="GET" class="search-form">
                <input 
                    type="text"
                    name="q"
                    placeholder="Search name or email…"
                    value="<%= typeof q !== 'undefined' ? q : '' %>"
                >
                <button type="submit" class="btn btn-secondary btn-small">Search</button>

                <% if (typeof q !== 'undefined' && q) { %>
                    <a href="/staff" class="search-clear-link">Clear</a>
                <% } %>
            </form>

        </div>

        <!-- EMPTY STATE -->
        <% if (accounts.length === 0) { %>

            <p>No manager or admin accounts found.</p>

        <% } else { %>

            <!-- TABLE -->
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th></th>
                        </tr>
                    </thead>

                    <tbody>
                        <% accounts.forEach(m => { %>
                            <tr>
                                <td><strong><%= m.first_name %> <%= m.last_name %></strong></td>
                                <td><%= m.email %></td>
                                <td><%= m.role %></td>

                                <td class="table-actions">

                                    <% if (isManager) { %>

                                        <a href="/staff/<%= m.user_id %>/edit" 
                                           class="btn btn-edit btn-table">
                                            Edit
                                        </a>

                                        <form action="/staff/<%= m.user_id %>/delete" method="POST">
                                            <button 
                                                type="submit" 
                                                class="btn btn-delete btn-table"
                                                onclick="return confirm('WARNING: Delete this manager account?');">
                                                Delete
                                            </button>
                                        </form>

                                    <% } %>

                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>

        <% } %>

        <!-- BACK BUTTON -->
        <div class="btn-wrapper" style="margin-top: 2rem;">
            <a href="/users/maintenance_index" class="btn btn-secondary btn-lg">
                ← Back to Maintenance Dashboard
            </a>
        </div>s

    </div>
</section>