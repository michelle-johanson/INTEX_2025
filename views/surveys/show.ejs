<section class="page-container">
    <div class="page-card-wide">

        <h1 class="page-title">Survey Details</h1>

        <div class="detail-card">

            <div class="detail-row">
                <span class="detail-label">Event</span>
                <span class="detail-value"><%= survey.event_name %></span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Occurrence Date</span>
                <span class="detail-value">
                    <%= new Date(survey.starts_at).toLocaleString() %>
                </span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Participant</span>
                <span class="detail-value">
                    <%= survey.first_name %> <%= survey.last_name %>
                </span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Satisfaction</span>
                <span class="detail-value"><%= survey.satisfaction_score %> / 5</span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Usefulness</span>
                <span class="detail-value"><%= survey.usefulness_score %> / 5</span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Recommendation</span>
                <span class="detail-value"><%= survey.recommendation_score %> / 5</span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Overall</span>
                <span class="detail-value"><%= survey.overall_score %> / 5</span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Comments</span>
                <span class="detail-value"><%= survey.comments || "—" %></span>
            </div>

            <div class="detail-row">
                <span class="detail-label">Submitted On</span>
                <span class="detail-value">
                    <%= survey.submission_date ? new Date(survey.submission_date).toLocaleDateString() : 'N/A' %>
                </span>
            </div>

        </div>

        <% 
            const roleRaw =
                session.access_level ||
                session.role ||
                (session.user && (session.user.access_level || session.user.role)) ||
                "";

            const isManager =
                roleRaw.toLowerCase() === "manager" ||
                roleRaw.toLowerCase() === "admin";
        %>

        <!-- MANAGER ACTIONS -->
        <% if (isManager) { %>
            <div class="btn-wrapper" style="margin-top: 2rem;">

                <a href="/surveys/<%= survey.event_occurrence_id %>/<%= survey.participant_id %>/edit"
                   class="btn btn-primary btn-lg">
                    Edit Survey
                </a>

                <form action="/surveys/<%= survey.event_occurrence_id %>/<%= survey.participant_id %>/delete"
                      method="POST"
                      onsubmit="return confirm('Delete this survey? This action cannot be undone.');">
                    <button type="submit" class="btn btn-delete btn-lg">
                        Delete Survey
                    </button>
                </form>

            </div>
        <% } %>

        <!-- BACK NAVIGATION -->
        <div class="btn-wrapper" style="margin-top: 2rem;">

            <% if (isManager) { %>
                <a href="/surveys/occurrence/<%= survey.event_occurrence_id %>" 
                   class="btn btn-secondary btn-lg">
                    ← Back to Results
                </a>
            <% } else { %>
                <a href="/surveys"
                   class="btn btn-secondary btn-lg">
                    ← Back to My Surveys
                </a>
            <% } %>

        </div>

    </div>
</section>
