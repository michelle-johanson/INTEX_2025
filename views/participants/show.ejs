<div class="page-container">

    <h1 class="page-title">Participant Details</h1>

    <% const isManager = session.access_level && (session.access_level.toLowerCase() === "manager" || session.access_level.toLowerCase() === "admin"); %>

    <div class="detail-card">
        <div class="detail-row">
            <span class="detail-label">Name</span>
            <span class="detail-value">
                <%= participant.first_name %> <%= participant.last_name %>
            </span>
        </div>

        <div class="detail-row">
            <span class="detail-label">Email</span>
            <span class="detail-value"><%= participant.email %></span>
        </div>

        <div class="detail-row">
            <span class="detail-label">Phone</span>
            <span class="detail-value"><%= participant.phone %></span>
        </div>

        <div class="detail-row">
            <span class="detail-label">Location</span>
            <span class="detail-value">
                <%= participant.city %>, <%= participant.state %> <%= participant.zip %>
            </span>
        </div>

        <div class="detail-row">
            <span class="detail-label">Role</span>
            <span class="detail-value"><%= participant.role %></span>
        </div>

        <div class="detail-row">
            <span class="detail-label">School / Employment</span>
            <span class="detail-value"><%= participant.school_or_employer %></span>
        </div>

        <div class="detail-row">
            <span class="detail-label">Field of Interest</span>
            <span class="detail-value"><%= participant.field_of_interest %></span>
        </div>

        <div class="detail-row">
            <span class="detail-label">Total Donations</span>
            <span class="detail-value">$<%= participant.total_donations || 0 %></span>
        </div>

        <!-- ============================================== -->
        <!-- ALWAYS VISIBLE BUTTON: REGISTERED EVENTS -->
        <!-- This link is the same for both participant (self-view) and admin (audit view) -->
        <% if (!isManager) { %>
        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #ddd;">
            <a href="/registrations/participant/<%= participant.participant_id %>" class="btn btn-info btn-large">
                View Registered Events
            </a>
            <a href="/milestones/participant/<%= participant.participant_id %>" class="btn btn-primary btn-small">
                View Milestones
            </a>
        </div>
        <% } %>
        <!-- ============================================== -->

        <% if (isManager) { %>
            <!-- Manager Actions Section (visible only to Admins/Managers) -->
            <div class="mt-4" style="padding-top: 1.5rem; border-top: 1px solid #ddd;">
                <h3 class="mb-2" style="font-size: 1.1rem; margin-bottom: 1rem; color: #555;">Management & Actions</h3>
                
                <div class="d-flex" style="gap: 10px; flex-wrap: wrap;">
                    
                    <a href="/milestones/participant/<%= participant.participant_id %>" class="btn btn-primary btn-small">
                        View Milestones
                    </a>

                    <a href="/participants/<%= participant.participant_id %>/edit" class="btn btn-secondary btn-small">
                        Edit Profile
                    </a>

                    <!-- Delete Form -->
                    <form action="/participants/<%= participant.participant_id %>/delete" 
                            method="POST"
                            onsubmit="return confirm('Are you sure you want to delete this participant?');">
                        <button class="btn btn-danger btn-small">Delete Participant</button>
                    </form>
                </div>
            </div>
        <% } %>
    </div>

    <% if (isManager) { %>
        <div class="mt-4">
            <a href="/participants" class="btn btn-secondary">‚Üê Back to Participant Directory</a>
        </div>
    <% } %>

</div>