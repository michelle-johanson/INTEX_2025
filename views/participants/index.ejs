<section class="page-container">
    <div class="container-inner">

        <!-- HEADER -->
        <div class="container-header">
            <h1 class="page-title">Participant Directory</h1>
            <div class="heading-underline"></div>
        </div>

        <% 
            const isManager = 
                session.access_level &&
                (session.access_level.toLowerCase() === "manager" ||
                 session.access_level.toLowerCase() === "admin");
        %>

        <!-- TABLE CONTROLS -->
        <%- include("../partials/tableControls", {
            showAddButton: isManager,
            addHref: "/participants/new",
            addLabel: "Add Participant",
            searchAction: "/participants",
            searchPlaceholder: "Search name or email…",
            query: q      // <-- must be provided by the route
        }) %>

        <!-- SEARCH CLEAR MESSAGE -->
        <% if (q) { %>
            <p class="search-clear">
                Showing results for "<strong><%= q %></strong>"
                — <a href="/participants">Clear</a>
            </p>
        <% } %>

        <!-- TABLE OR EMPTY MESSAGE -->
        <% if (!participants || participants.length === 0) { %>

            <p>No participants found.</p>

        <% } else { %>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>City</th>
                            <th>Field of Interest</th>
                            <th>Total Donations</th>
                            <th></th>
                        </tr>
                    </thead>

                    <tbody>
                        <% participants.forEach(p => { %>
                            <tr>
                                <td><%= p.first_name %> <%= p.last_name %></td>
                                <td><%= p.email %></td>
                                <td><%= p.city %>, <%= p.state %></td>
                                <td><%= p.field_of_interest %></td>
                                <td>$<%= p.total_donations || 0 %></td>

                                <td class="table-actions">
                                    <a href="/participants/<%= p.participant_id %>" 
                                       class="btn btn-outline btn-table">
                                        View
                                    </a>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>

        <% } %>

    </div>
</section>
