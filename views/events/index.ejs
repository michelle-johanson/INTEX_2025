<section class="page-container">

    <%
        // Normalize session user role
        const user = session.user || session;
        const rawRole = user.access_level || user.role || "";
        const isManager = rawRole.toLowerCase() === "manager" || rawRole.toLowerCase() === "admin";
    %>

    <!-- HEADER AREA -->
    <div class="container-header">
        <h1>Event Types</h1>

        <div class="page-actions">

            <!-- Create Button -->
            <% if (isManager) { %>
                <a href="/events/new" class="btn btn-primary btn-small">
                    + Create New Event Type
                </a>
            <% } else { %>
                <span></span>
            <% } %>

                <!-- Search Bar -->
                <form action="/events" method="GET" class="search-bar">
                    <input type="text" name="search" placeholder="Search event name or type..."
                        class="search-input" value="<%= searchTerm || '' %>">

                    <button type="submit" class="btn btn-secondary btn-small">
                        Search
                    </button>

                    <% if (searchTerm) { %>
                        <a href="/events" class="btn btn-outline btn-small">Clear</a>
                    <% } %>
            </form>

        </div>
    </div>

    <!-- TABLE AREA -->
    <div class="container-inner">

        <% if (events.length===0) { %>
            <p>No event types found.</p>
            <% } else { %>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Type</th>
                                <th></th>
                            </tr>
                        </thead>

                        <tbody>
                            <% events.forEach(e=> { %>
                                <tr>
                                    <td>
                                        <%= e.name %>
                                    </td>
                                    <td>
                                        <%= e.type %>
                                    </td>
                                    <td class="table-actions">
                                        <a href="/events/<%= e.event_id %>" class="btn btn-table-details btn-small">
                                            View
                                        </a>
                                    </td>
                                </tr>
                                <% }) %>
                        </tbody>
                    </table>
                </div>

                <% } %>

    </div>
</section>
