<%
    let qValue = (typeof q !== "undefined") ? q : "";
    // Normalize session user role safely
    const s = session || {};
    const user = s.user || s;
    const rawRole = (user.access_level || user.role || "").toLowerCase();
    const isManager = rawRole === "manager" || rawRole === "admin";
%>

<section class="page-container">
<div class="container-inner">

    <!-- HEADER AREA -->
    <div class="container-header">
        <h1>Event Types</h1>
        <div class="heading-underline" aria-hidden="true"></div>
    </div>

    <%- include("../partials/tableControls", {
        showAddButton: isManager,
        addHref: "/events/new",
        searchAction: "/events",
        searchPlaceholder: "Search events...",
        searchQuery: qValue,
        searchParamName: "q"
    }) %>

    <!-- TABLE AREA -->

    <% if (!events || events.length === 0) { %>
        <p>No event types found.</p>
    <% } else { %>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Type</th>
                        <th></th>
                    </tr>
                </thead>

                <tbody>
                    <% events.forEach(event => { %>
                        <tr>
                            <td><%= event.name %></td>
                            <td><%= event.type %></td>
                            <td class="table-actions">
                                <a href="/events/<%= event.event_id %>" class="btn btn-outline btn-table">
                                    View
                                </a>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>

    <% } %>

</div>
</section>
