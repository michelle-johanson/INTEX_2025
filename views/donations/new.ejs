<section class="page-container">
    <div class="page-card-form">

        <h1 class="page-title">Make a Donation</h1>
        <p class="page-subtitle">
            Support Ella Rises by making a one-time donation.
        </p>

        <% 
            // Preload values (pendingDonation comes from session)
            const hasPending = pendingDonation && typeof pendingDonation === "object";
            const defaultDate = new Date().toISOString().split("T")[0];
        %>

        <form action="/donations/new" method="POST" class="form">

            <!-- LOGGED-IN USER -->
            <% if (user) { %>

                <label>Donor Profile</label>
                <input 
                    type="text"
                    value="<%= user.first_name %> <%= user.last_name %> (ID #<%= user.participant_id %>)"
                    disabled
                    class="input-disabled"
                />

                <!-- Backend reads the session, but this is OK to include for consistency -->
                <input type="hidden" name="ParticipantID" value="<%= user.participant_id %>">

                <p class="text-muted" style="margin-top: 0.5rem;">
                    You are logged in as <strong><%= user.first_name %></strong>.
                </p>

            <% } else { %>

                <!-- GUEST USER PANEL -->
                <div class="info-box info-box-blue">
                    <strong>Welcome!</strong>  
                    <br>
                    Enter your donation details below. You will be asked to 
                    <b>log in</b> or <b>sign up</b> on the next step to finalize securely.
                </div>

            <% } %>

            <!-- DONATION DATE -->
            <label for="DonationDate">Donation Date</label>
            <input 
                id="DonationDate"
                type="date"
                name="DonationDate"
                value="<%= hasPending && pendingDonation.date ? pendingDonation.date : defaultDate %>"
                required
            />

            <!-- DONATION AMOUNT -->
            <label for="DonationAmount">Donation Amount (USD)</label>
            <input 
                id="DonationAmount"
                type="number"
                name="DonationAmount"
                min="1"
                step="0.01"
                value="<%= hasPending && pendingDonation.amount ? pendingDonation.amount : '' %>"
                required
            />

            <!-- ACTION BUTTONS -->
            <div class="btn-wrapper" style="margin-top: 1.75rem;">
                <button type="submit" class="btn btn-primary btn-lg">
                    <%= user ? "Confirm Donation" : "Proceed to Login / Signup" %>
                </button>

                <a href="/" class="btn btn-secondary btn-lg">
                    Cancel
                </a>
            </div>

        </form>

    </div>
</section>
